# 지도 수정

## 1. 상세 페이지 지도 검토

### 1-1. 현재 상황

- 사이드 바: 일자별 제목과 클릭 시 아코디언 형식으로 나타나는 내용이 있다.
- 지도: 일자별 마커가 있다. 이는 그날 일정의 종료 지점이다.

### 1-2. 개선 방향

- 지도: 일자별 루트를 표시한다. 이를 전체적으로 보여주는 줌 레벨이 랜딩 시에 보여지면 사용자로 하여금 전체 일정을 파악하는 데 도움이 된다.
- 지도: 일자별 루트는 사이드 바에서 일자를 선택 시 해당 일자의 루트가 하이라이트 된다. 이는 사용자로 하여금 해당 일자의 루트를 가시적으로 구별하는데 도움이 된다.
- 지도: 사이드바와 지도가 인터렉션이 되도록 기능을 구현한다.
- 사이드 바: 내용에 일자별 하이라이트 혹은 주의할 점, 꼭 가야할 포인트 등의 추가적인 요소가 있으면 어떨까. 이도 역시 다른 형식의 마커로 추가하면 되겠군.
- 고민해보자: 일자별 루트의 시작점을 어떻게 표시해야 하나. 대부분은 마커에 가려있지만 시작일의 시작점이 문제군. 직접 구현해보고 어떻게 그려지는지를 직접 봐야 알듯.

## 2. 상세 페이지 지도 개선

### 2-1. 기본 코드

- 라인 그리기: 데이터에서 루트를 그릴 좌표를 구별해 이를 라인으로 그린다.

```jsx
map.addSource('trace', {
  type: 'geojson',
  data: {
    type: 'Feature',
    properties: {},
    geometry: {
      type: 'LineString',
      coordinates: targetRoute,
    },
  },
});
map.addLayer({
  type: 'line',
  source: 'trace',
  id: 'line',
  paint: {
    'line-color': 'black',
    'line-width': 5,
  },
  layout: {
    'line-cap': 'round',
    'line-join': 'round',
  },
});
```

### 2-2. 데이터 가져오기

- 데이터를 살펴보니 geometry 밑에 routes 배열 형식으로 넣으면 가능할 듯 하다. 당장 더미로 넣는 건 쉬운데 대량의 작업을 하려면 데이터의 형식을 넘겨받기 편하게 세팅부터 해야 한다.
- 직접 geojson 형태의 좌표를 만들어보니 대략 14일 일정에 1200줄의 코드가 나온다. 하루 100줄로 어림 계산해볼 수 있겠다.
- geojson 제작 후 포인트, 폴리곤, 라인이 각각의 객체 형태로 저장이 된다. 공통되는 일자의 값을 가지게끔 하면 각 일자별 데이터를 표시할 수 있다. 이를 이용해 필터로 데이터를 구별할 수 있겠다.
- 위 방법이 아니라면 제작한 geojson 파일을 수 작업으로 일자별로 합치는 수고를 해야 한다.

```jsx
// geojson file sample

{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": { "order": 2, "name": "베로나" },
      "properties": {
        "order": 13,
        "name": "베로나",
        "content": "발 폴리첼라 지역의 와인은 이태리 3대 와인 중 하나인 아마로네가 생산되는 지역입니다. 와이너리를 방문해 이 지역의 와인을 직접 맛보고 시음해봅시다."
      },
      "geometry": {
        "coordinates": [10.99004723432705, 45.43794658137611],
        "type": "Point"
      },
      "id": 1
    },
		{
      "type": "Feature",
      "properties": { "order": 2 },
      "geometry": {
        "coordinates": [
          [8.72043697265255, 45.62986371232441],
          [9.100686363518292, 45.53224468331618],
          [10.323453953370148, 45.49158402276362],
          [11.02205634528599, 45.39160675552691],
          [12.257132040536504, 45.4702519838674],
          [12.30041987379198, 46.19702456359835],
          [12.369288956242258, 46.42285292671059],
          [12.248428004183836, 46.41922593116388],
          [12.136698368007956, 46.53832530682436]
        ],
        "type": "LineString"
      },
      "id": 18
    },
		{
      "type": "Feature",
      "properties": { "order": 2 },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [12.289866155497464, 46.64858188292608],
            [12.287113993610781, 46.64848903540988],
            [12.284388364659026, 46.64821138798445],
            [12.281715544968602, 46.64775161736237],
            [12.279121300161878, 46.64711415595886],
            [12.27663063606181, 46.64630514902926],
            [12.274267557032585, 46.64533239525002],
            // ... 기니까 생략
          ]
        ]
      },
      "id": 20
    },
	]
}
```

- 폴리곤이 좌표가 많다. 원의 형태로 표시했더니 이 모양이군. 다시 다각형 좌표를 직접 지정하는 방향으로 수정해야겠다.

### 2-3. 폴리곤 원 표현하기

- mapbox 에서 원을 그리는 코드가 존재하니 위의 경우처럼 원을 그리는 좌표를 여러개 가져올 필요가 없어졌다. 중심점만 찾아서 type을 따로 지정하는 방식으로 바꾸자.

```jsx
// make circle polygon

initializedMap.addLayer({
  id: 'places',
  type: 'circle',
  source: 'places',
  paint: {
    'circle-radius': 5,
    'circle-color': '#007cbf',
  },
  filter: ['==', '$type', 'Point'],
});
```

- 색도 칠해주자

```jsx
// fill color

initializedMap.addLayer({
  id: 'polygon',
  type: 'fill',
  source: 'places',
  layout: {},
  paint: {
    'fill-color': '#41644a',
    'fill-opacity': 0.3,
  },
  filter: ['==', '$type', 'Polygon'],
});
```

- 여기서 잠깐. addLayer 할 때 소스로 쓰고 있는 places는 .addSource가 되어 있어야 사용 가능하다.

## 3. 개선해야 할 점

- 치명적이거나 콘솔에서 경고하는 에러는 아니다.
- [ ] 라인에 대한 hover 기능이 작동하지 않는다.
- [ ] order가 여러개라 사이드바에 표시할 대표 order를 어떻게 구별할지 규칙 필요
- [ ] 지도에 표시되는 order가 똑같아서 대표 order를 어떻게 구별하고 표시할지 규칙 필요
- [ ] 라인 색이 진해서 opacity를 적용하면 라인이 겹치는 부분은 진해져서 통일감이 사라짐.
- [ ] javascript 형식으로 이벤트 처리를 해야 원할히 작동하니 잔고장 없는 코드 고민 필요
